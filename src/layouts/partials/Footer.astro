---
import Logo from "@/components/Logo.astro";
import Social from "@/components/Social.astro";
import config from "@/config/config.json";
import menu from "@/config/menu.json";
import social from "@/config/social.json";
import { markdownify } from "@/lib/utils/textConverter";

const { footer } = menu;

// Function to replace {year} this from string to year
function replaceYear(text: string) {
  const year = new Date().getFullYear();

  return text.replace("{year}", year.toString());
}
---

<footer class="section pb-0 text-center md:text-left overflow-x-hidden">
  <div class="container">
    <!-- Top Section -->
    <div
      class="flex flex-col lg:flex-row gap-10 lg:gap-0 justify-between mb-10 lg:mb-28 max-lg:text-center"
    >
      <!-- Left -->
      <div class="w-full lg:w-[25%]">
        <div data-aos="fade-right-sm" data-aos-delay="100">
          <Logo width={160} height={40} />
        </div>

        <p
          data-aos="fade-right-sm"
          data-aos-delay="200"
          class="mt-8 text-balance"
          set:html={markdownify(config.params.footer_description)}
        />
      </div>

      <!-- middle -->
      <div
        data-aos="fade-up-sm"
        data-aos-delay="100"
        class="flex flex-col md:flex-row justify-between w-full lg:max-w-[30%] gap-10 xl:gap-0"
      >
        {
          footer.map((menu) => (
            <div class="w-full lg:max-w-37.5 flex flex-col gap-4">
              <h6
                data-aos="fade-up-sm"
                data-aos-delay="100"
                class="font-semibold"
              >
                {menu.title}
              </h6>
              <ul class="flex flex-col gap-4">
                {menu.children.map((link, i) => (
                  <li data-aos="fade-up-sm" data-aos-delay={100 + i * 100}>
                    <a href={link.url} class="hover:text-primary text-sm">
                      {link.name}
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          ))
        }
      </div>

      <!-- right  -->
      {
        config.subscription_in_footer &&
          config.subscription_in_footer.enable && (
            <div class="md:w-[70%] lg:w-[30%] mx-auto">
              <h6
                data-aos="fade-left-sm"
                data-aos-delay="100"
                class="font-semibold mb-4"
              >
                Newsletter
              </h6>
              <form
                action={config.subscription_in_footer.mailchimp_form_action}
                target="_blank"
                method="post"
              >
                <div
                  data-aos="fade-left-sm"
                  data-aos-delay="200"
                  class="flex justify-between rounded-lg bg-light px-3 py-2 border border-border mb-5"
                >
                  <input
                    type="email"
                    placeholder="Enter your email"
                    class="form-input w-full rounded-full border-transparent! bg-transparent! py-2! pl-2! placeholder:opacity-100! placeholder:font-normal"
                    required
                    name={config.subscription_in_footer.mailchimp_form_name}
                  />
                  <button
                    title="Subscribe"
                    class="transition hover:opacity-80 pr-2"
                    type="submit"
                  >
                    <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
                      <path
                        fill-rule="evenodd"
                        clip-rule="evenodd"
                        d="M17.1772.0665905C17.3647-.0359303 17.5912-.0187131 17.7637.108851 17.9362.237198 18.0247.454761 17.994.673889L15.9315 15.152C15.9067 15.3234 15.81 15.476 15.6675 15.5668 15.5782 15.6231 15.477 15.6521 15.375 15.6521 15.3135 15.6521 15.252 15.6411 15.1935 15.6208L7.33126 12.8167 15.0622 3.09761 5.07152 12.0114.380282 10.3382C.168033 10.2623.0187833 10.062.00153335 9.8272-.0149666 9.5932.102783 9.37094.302282 9.26216L17.1772.0665905zM6.56261 17.413V13.7833l3.05024 1.0879-2.03474 2.8893C7.47011 17.9139 7.30061 18 7.12511 18 7.06661 18 7.00736 17.9906 6.94961 17.971 6.71861 17.8912 6.56261 17.6666 6.56261 17.413z"
                        fill="#070127"
                      />
                    </svg>
                  </button>
                </div>

                <label
                  data-aos="fade-left-sm"
                  data-aos-delay="300"
                  for="checkbox"
                  class="text-sm block"
                  style="line-height:normal"
                >
                  <input
                    type="checkbox"
                    name="checkbox"
                    id="checkbox"
                    required
                    class="appearance-auto rounded-sm accent-primary ring-0"
                  />
                  <span>I agree with </span>
                  <a
                    href="/privacy-policy"
                    class="text-text-dark font-semibold hover:text-primary transition duration-300"
                  >
                    privacy policy.
                  </a>
                </label>
              </form>
            </div>
          )
      }
    </div>

    <!-- Bottom -->
    <div
      class="py-6 border-t border-border flex flex-col-reverse gap-4 md:flex-row justify-between"
    >
      <Social source={social.main} className="social-icons" />

      <p
        class="opacity-80 [&>a]:underline [&>a]:text-text-dark text-sm"
        set:html={markdownify(replaceYear(config.params.copyright))}
      />
    </div>
  </div>
</footer>
